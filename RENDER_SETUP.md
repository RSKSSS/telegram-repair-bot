# Инструкция по настройке телеграм-бота на Render

## Описание проблемы
При деплое телеграм-бота на платформу Render возникает конфликт портов между Flask-приложением и телеграм-ботом. Оба пытаются использовать порт 5000, что приводит к ошибке "Address already in use".

## Созданные файлы для решения проблемы
В репозитории созданы специальные файлы для корректного запуска бота на Render:

1. `minimal_bot.py` - минимальная версия бота для тестирования базовой функциональности
2. `main_render.py` - специальная версия для запуска бота на Render без Flask
3. `main_telegram_bot.py` - универсальный файл запуска, который определяет среду и выбирает подходящий способ запуска
4. `flask_app.py` - файл для запуска Flask-приложения на порту 5001

## Настройка окружения на Render

### Вариант 1: Запустить только бота

Для запуска только телеграм-бота без веб-интерфейса, необходимо настроить следующие параметры на Render:

1. **Start Command**: `python main_telegram_bot.py`
2. **Environment Variables**:
   - `TELEGRAM_BOT_TOKEN`: [ваш токен бота]
   - `RENDER`: `true`
   - `DATABASE_URL`: [ваш URL PostgreSQL базы данных]

### Вариант 2: Запустить бота и Flask отдельно

Если вам нужен и бот, и веб-интерфейс, вы можете настроить два отдельных сервиса на Render:

#### Сервис 1: Telegram Bot
- **Name**: [ваш проект]-bot
- **Start Command**: `python main_telegram_bot.py`
- **Environment Variables**: 
  - `TELEGRAM_BOT_TOKEN`: [ваш токен бота]
  - `RENDER`: `true`
  - `DATABASE_URL`: [ваш URL PostgreSQL базы данных]

#### Сервис 2: Flask Web Interface
- **Name**: [ваш проект]-web
- **Start Command**: `gunicorn --bind 0.0.0.0:5000 --reuse-port --reload flask_app:app`
- **Environment Variables**:
  - `DATABASE_URL`: [ваш URL PostgreSQL базы данных]
  - `FLASK_PORT`: `5000`

## Тестирование
После деплоя на Render, вы можете проверить работоспособность бота следующими способами:

1. Отправьте команду `/start` боту в Telegram
2. Отправьте команду `/info` для получения системной информации
3. Отправьте команду `/ping` для проверки доступности бота

## Устранение неполадок

### Бот не отвечает
1. Проверьте логи на Render
2. Убедитесь, что токен бота корректный
3. Проверьте подключение к базе данных

### Конфликт портов
Если вы видите ошибку "Address already in use", это означает, что несколько приложений пытаются использовать один порт. В этом случае:

1. Используйте разные порты для разных сервисов
2. Запустите только один сервис на Render
3. Используйте специализированные файлы, созданные для решения этой проблемы

## Дополнительная информация
Для более подробной информации о проблемах и их решениях смотрите файл `debug_log.md` в репозитории.